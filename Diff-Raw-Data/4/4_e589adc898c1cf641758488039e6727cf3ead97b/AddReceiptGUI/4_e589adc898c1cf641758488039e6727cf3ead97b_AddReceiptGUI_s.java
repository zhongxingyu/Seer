 /*
  * To change this template, choose Tools | Templates
  * and open the template in the editor.
  */
 package gui;
 
 import java.text.ParseException;
 import java.text.SimpleDateFormat;
 import java.util.Calendar;
 import java.util.logging.Level;
 import java.util.logging.Logger;
 
 import javax.swing.JLabel;
 import javax.swing.UIManager;
 import javax.swing.UnsupportedLookAndFeelException;
 import javax.swing.table.DefaultTableModel;
 
 import net.java.balloontip.BalloonTip;
 import net.java.balloontip.BalloonTip.AttachLocation;
 import net.java.balloontip.BalloonTip.Orientation;
 import net.java.balloontip.styles.BalloonTipStyle;
 import net.java.balloontip.styles.EdgedBalloonStyle;
 import net.java.balloontip.styles.MinimalBalloonStyle;
 import net.java.balloontip.styles.RoundedBalloonStyle;
 import net.java.balloontip.utils.FadingUtils;
 import net.java.balloontip.utils.TimingUtils;
 
 import controller.Controller;
 import db.Customer;
 import db.ReceiptArticle;
 
 import java.awt.Color;
 import java.awt.Dimension;
 import java.awt.Toolkit;
 import java.util.ArrayList;
 
 /**
  *
  * @author Pagge
  */
 public class AddReceiptGUI extends javax.swing.JFrame {
 	private static final long serialVersionUID = 1L;
 	private Controller controller;
     private ArrayList<ReceiptArticle> articles;
 	private DefaultTableModel model;
 	private SimpleDateFormat dateFormat;
 	
 	//BALLOONTIPS
 	private BalloonTipStyle style;
 	private BalloonTip balloonFirstName;
 	private BalloonTip balloonLastName;
 	private BalloonTip balloonPhone;
 	private BalloonTip balloonEmail;
 	private BalloonTip balloonReceiptNbr;
 	private BalloonTip balloonLastPayDate;
 	private BalloonTip balloonArticles;
 	
 	//ERRORMSGS
 	private final String erB = "<html><b>Fel:</b> ";
 	private final String erE = "</html>";
	private final String miss = " m?ste fyllas i.";
	private final String err = " f?r endast inneh?lla ";
 	
 	/**
      * Creates new form AddReciptGUI
      * @param controller 
      */
     public AddReceiptGUI(Controller controller) {
     	this.controller = controller;
         this.articles = new ArrayList<ReceiptArticle>();
     	this.dateFormat = new SimpleDateFormat("yyyy-MM-dd");
         
         try {
          // UIManager.setLookAndFeel(UIManager.getSystemLookAndFeelClassName());
         	UIManager.setLookAndFeel(UIManager.getSystemLookAndFeelClassName());
         } catch (ClassNotFoundException ex) {
                     Logger.getLogger(KundGUI.class.getName()).log(Level.SEVERE, null, ex);
         } catch (InstantiationException ex) {
                     Logger.getLogger(KundGUI.class.getName()).log(Level.SEVERE, null, ex);
         } catch (IllegalAccessException ex) {
                     Logger.getLogger(KundGUI.class.getName()).log(Level.SEVERE, null, ex);
         } catch (UnsupportedLookAndFeelException ex) {
                     Logger.getLogger(KundGUI.class.getName()).log(Level.SEVERE, null, ex);
         }
         
         this.style = new RoundedBalloonStyle(3, 1, Color.WHITE, new Color(255,0,0));
         
         this.balloonFirstName = null;
         this.balloonLastName = null;
         this.balloonPhone = null;
         this.balloonEmail = null;
         this.balloonReceiptNbr = null;
         this.balloonLastPayDate = null;
         this.balloonArticles = null;
         
         initComponents();
         
         this.setVisible(true);
         this.model = (DefaultTableModel)tableArticles.getModel();
         //Sets the date to todays date + 1 week in yyyy-MM-dd format
         Calendar today = Calendar.getInstance();
         today.add(Calendar.WEEK_OF_YEAR, 1);
         String date = KundGUI.DATE_FORMAT.format(today.getTime());
         fieldDate.setText(date);
         
         //Centrerar fnstret
         Toolkit tk = Toolkit.getDefaultToolkit();
         Dimension screenSize = tk.getScreenSize();
         int screenHeight = screenSize.height;
         int screenWidth = screenSize.width;
         setLocation(screenWidth / 4 + this.getWidth() / 2, screenHeight / 4);
         this.setTitle("Lgg Till Kvitto");
         
     }
 
     /**
      * This method is called from within the constructor to initialize the form.
      * WARNING: Do NOT modify this code. The content of this method is always
      * regenerated by the Form Editor.
      */
     @SuppressWarnings("unchecked")
     // <editor-fold defaultstate="collapsed" desc="Generated Code">//GEN-BEGIN:initComponents
     private void initComponents() {
 
         panelCustomer = new javax.swing.JPanel();
         labelFirstName = new javax.swing.JLabel();
         fieldFirstName = new javax.swing.JTextField();
         labelLastName = new javax.swing.JLabel();
         fieldLastName = new javax.swing.JTextField();
         labelPhoneNbr = new javax.swing.JLabel();
         fieldPhoneNbr = new javax.swing.JTextField();
         labelEmail = new javax.swing.JLabel();
         fieldEmail = new javax.swing.JTextField();
         jButton1 = new javax.swing.JButton();
         jButton2 = new javax.swing.JButton();
         panelReceipt = new javax.swing.JPanel();
         jPanel3 = new javax.swing.JPanel();
         labelReceiptNbr = new javax.swing.JLabel();
         fieldReceiptNbr = new javax.swing.JTextField();
         labelAddArticles = new javax.swing.JLabel();
         buttonAddArticle = new javax.swing.JButton();
         buttonRemoveArticle = new javax.swing.JButton();
         labelLastPayDay = new javax.swing.JLabel();
         fieldDate = new javax.swing.JTextField();
         checkIsPaid = new javax.swing.JCheckBox();
         jScrollPane2 = new javax.swing.JScrollPane();
         tableArticles = new javax.swing.JTable();
         buttonCancel = new javax.swing.JButton();
         buttonAddReceipt = new javax.swing.JButton();
 
         setDefaultCloseOperation(javax.swing.WindowConstants.DISPOSE_ON_CLOSE);
         setResizable(false);
 
         panelCustomer.setBorder(javax.swing.BorderFactory.createTitledBorder(null, "KundInfo", javax.swing.border.TitledBorder.DEFAULT_JUSTIFICATION, javax.swing.border.TitledBorder.DEFAULT_POSITION, new java.awt.Font("Verdana", 1, 9))); // NOI18N
 
         labelFirstName.setText("Frnamn");
 
         labelLastName.setText("Efternamn");
 
         labelPhoneNbr.setText("Telefon");
 
         labelEmail.setText("Email");
 
         jButton1.setText("Vlj Kund");
         jButton1.setToolTipText("");
         jButton1.addActionListener(new java.awt.event.ActionListener() {
             public void actionPerformed(java.awt.event.ActionEvent evt) {
                 jButton1ActionPerformed(evt);
             }
         });
 
         jButton2.setText("Tm Flt");
         jButton2.addActionListener(new java.awt.event.ActionListener() {
             public void actionPerformed(java.awt.event.ActionEvent evt) {
                 jButton2ActionPerformed(evt);
             }
         });
 
         javax.swing.GroupLayout panelCustomerLayout = new javax.swing.GroupLayout(panelCustomer);
         panelCustomer.setLayout(panelCustomerLayout);
         panelCustomerLayout.setHorizontalGroup(
             panelCustomerLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
             .addGroup(panelCustomerLayout.createSequentialGroup()
                 .addContainerGap()
                 .addGroup(panelCustomerLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                     .addComponent(fieldFirstName)
                     .addComponent(fieldLastName)
                     .addComponent(fieldPhoneNbr)
                     .addComponent(fieldEmail, javax.swing.GroupLayout.DEFAULT_SIZE, 168, Short.MAX_VALUE)
                     .addGroup(panelCustomerLayout.createSequentialGroup()
                         .addGroup(panelCustomerLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                             .addComponent(labelFirstName)
                             .addComponent(labelLastName)
                             .addComponent(labelPhoneNbr)
                             .addComponent(labelEmail))
                         .addGap(0, 0, Short.MAX_VALUE))
                     .addGroup(panelCustomerLayout.createSequentialGroup()
                         .addComponent(jButton1)
                         .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                         .addComponent(jButton2)))
                 .addContainerGap())
         );
 
         panelCustomerLayout.linkSize(javax.swing.SwingConstants.HORIZONTAL, new java.awt.Component[] {jButton1, jButton2});
 
         panelCustomerLayout.setVerticalGroup(
             panelCustomerLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
             .addGroup(panelCustomerLayout.createSequentialGroup()
                 .addGap(6, 6, 6)
                 .addGroup(panelCustomerLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                     .addComponent(jButton1)
                     .addComponent(jButton2))
                 .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.UNRELATED)
                 .addComponent(labelFirstName)
                 .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                 .addComponent(fieldFirstName, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                 .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                 .addComponent(labelLastName)
                 .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                 .addComponent(fieldLastName, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                 .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                 .addComponent(labelPhoneNbr)
                 .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                 .addComponent(fieldPhoneNbr, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                 .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                 .addComponent(labelEmail)
                 .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                 .addComponent(fieldEmail, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                 .addContainerGap(javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE))
         );
 
         panelReceipt.setBorder(javax.swing.BorderFactory.createTitledBorder(null, "KvittoInfo", javax.swing.border.TitledBorder.DEFAULT_JUSTIFICATION, javax.swing.border.TitledBorder.DEFAULT_POSITION, new java.awt.Font("Verdana", 1, 9))); // NOI18N
 
         labelReceiptNbr.setText("Kvittonummer");
 
         fieldReceiptNbr.setText("0123");
         fieldReceiptNbr.addActionListener(new java.awt.event.ActionListener() {
             public void actionPerformed(java.awt.event.ActionEvent evt) {
                 fieldReceiptNbrActionPerformed(evt);
             }
         });
 
         javax.swing.GroupLayout jPanel3Layout = new javax.swing.GroupLayout(jPanel3);
         jPanel3.setLayout(jPanel3Layout);
         jPanel3Layout.setHorizontalGroup(
             jPanel3Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
             .addGroup(jPanel3Layout.createSequentialGroup()
                 .addGroup(jPanel3Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING, false)
                     .addComponent(labelReceiptNbr, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                     .addComponent(fieldReceiptNbr, javax.swing.GroupLayout.PREFERRED_SIZE, 66, javax.swing.GroupLayout.PREFERRED_SIZE))
                 .addContainerGap(javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE))
         );
         jPanel3Layout.setVerticalGroup(
             jPanel3Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
             .addGroup(jPanel3Layout.createSequentialGroup()
                 .addComponent(labelReceiptNbr)
                 .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                 .addComponent(fieldReceiptNbr, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE))
         );
 
         labelAddArticles.setText("Artiklar");
 
         buttonAddArticle.setText("+");
         buttonAddArticle.addActionListener(new java.awt.event.ActionListener() {
             public void actionPerformed(java.awt.event.ActionEvent evt) {
                 buttonAddArticleActionPerformed(evt);
             }
         });
 
         buttonRemoveArticle.setText("-");
         buttonRemoveArticle.addActionListener(new java.awt.event.ActionListener() {
             public void actionPerformed(java.awt.event.ActionEvent evt) {
                 buttonRemoveArticleActionPerformed(evt);
             }
         });
 
         labelLastPayDay.setText("Sista betalningsdag");
 
         fieldDate.setText("2012-03-23");
 
         checkIsPaid.setText("Betald");
 
         tableArticles.setAutoCreateRowSorter(true);
         tableArticles.setModel(new javax.swing.table.DefaultTableModel(
             new Object [][] {
 
             },
             new String [] {
                 "Artikel", "Antal", "Pris"
             }
         ) {
             Class[] types = new Class [] {
                 java.lang.String.class, java.lang.String.class, java.lang.String.class
             };
             boolean[] canEdit = new boolean [] {
                 false, false, false
             };
 
             public Class getColumnClass(int columnIndex) {
                 return types [columnIndex];
             }
 
             public boolean isCellEditable(int rowIndex, int columnIndex) {
                 return canEdit [columnIndex];
             }
         });
         tableArticles.setDragEnabled(true);
         tableArticles.getTableHeader().setReorderingAllowed(false);
         tableArticles.setSelectionMode(javax.swing.ListSelectionModel.SINGLE_SELECTION);
         jScrollPane2.setViewportView(tableArticles);
 
         javax.swing.GroupLayout panelReceiptLayout = new javax.swing.GroupLayout(panelReceipt);
         panelReceipt.setLayout(panelReceiptLayout);
         panelReceiptLayout.setHorizontalGroup(
             panelReceiptLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
             .addGroup(panelReceiptLayout.createSequentialGroup()
                 .addContainerGap()
                 .addGroup(panelReceiptLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                     .addComponent(jPanel3, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                     .addGroup(javax.swing.GroupLayout.Alignment.TRAILING, panelReceiptLayout.createSequentialGroup()
                         .addGroup(panelReceiptLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                             .addComponent(labelAddArticles)
                             .addGroup(panelReceiptLayout.createSequentialGroup()
                                 .addComponent(buttonAddArticle)
                                 .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                                 .addComponent(buttonRemoveArticle))
                             .addGroup(panelReceiptLayout.createSequentialGroup()
                                 .addComponent(fieldDate, javax.swing.GroupLayout.PREFERRED_SIZE, 72, javax.swing.GroupLayout.PREFERRED_SIZE)
                                 .addGap(18, 18, 18)
                                 .addComponent(checkIsPaid)))
                         .addGap(12, 47, Short.MAX_VALUE))
                     .addGroup(panelReceiptLayout.createSequentialGroup()
                         .addGroup(panelReceiptLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                             .addComponent(jScrollPane2, javax.swing.GroupLayout.PREFERRED_SIZE, 0, Short.MAX_VALUE)
                             .addGroup(javax.swing.GroupLayout.Alignment.TRAILING, panelReceiptLayout.createSequentialGroup()
                                 .addComponent(labelLastPayDay)
                                 .addGap(0, 0, Short.MAX_VALUE)))
                         .addContainerGap())))
         );
 
         panelReceiptLayout.linkSize(javax.swing.SwingConstants.HORIZONTAL, new java.awt.Component[] {buttonAddArticle, buttonRemoveArticle});
 
         panelReceiptLayout.setVerticalGroup(
             panelReceiptLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
             .addGroup(panelReceiptLayout.createSequentialGroup()
                 .addContainerGap()
                 .addComponent(jPanel3, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                 .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                 .addComponent(labelLastPayDay)
                 .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                 .addGroup(panelReceiptLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                     .addComponent(fieldDate, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                     .addComponent(checkIsPaid))
                 .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                 .addComponent(labelAddArticles)
                 .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                 .addComponent(jScrollPane2, javax.swing.GroupLayout.PREFERRED_SIZE, 111, javax.swing.GroupLayout.PREFERRED_SIZE)
                 .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                 .addGroup(panelReceiptLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                     .addComponent(buttonRemoveArticle)
                     .addComponent(buttonAddArticle))
                 .addContainerGap(javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE))
         );
 
         buttonCancel.setText("Avbryt");
         buttonCancel.addActionListener(new java.awt.event.ActionListener() {
             public void actionPerformed(java.awt.event.ActionEvent evt) {
                 buttonCancelActionPerformed(evt);
             }
         });
 
         buttonAddReceipt.setText("Lgg till");
         buttonAddReceipt.addActionListener(new java.awt.event.ActionListener() {
             public void actionPerformed(java.awt.event.ActionEvent evt) {
                 buttonAddReceiptActionPerformed(evt);
             }
         });
 
         javax.swing.GroupLayout layout = new javax.swing.GroupLayout(getContentPane());
         getContentPane().setLayout(layout);
         layout.setHorizontalGroup(
             layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
             .addGroup(layout.createSequentialGroup()
                 .addContainerGap()
                 .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                     .addGroup(layout.createSequentialGroup()
                         .addComponent(panelCustomer, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                         .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                         .addComponent(panelReceipt, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                         .addGap(0, 0, Short.MAX_VALUE))
                     .addGroup(javax.swing.GroupLayout.Alignment.TRAILING, layout.createSequentialGroup()
                         .addGap(0, 0, Short.MAX_VALUE)
                         .addComponent(buttonAddReceipt)
                         .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                         .addComponent(buttonCancel)))
                 .addContainerGap())
         );
         layout.setVerticalGroup(
             layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
             .addGroup(layout.createSequentialGroup()
                 .addContainerGap()
                 .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING, false)
                     .addComponent(panelCustomer, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                     .addComponent(panelReceipt, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE))
                 .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                 .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                     .addComponent(buttonAddReceipt)
                     .addComponent(buttonCancel))
                 .addContainerGap(javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE))
         );
 
         pack();
     }// </editor-fold>//GEN-END:initComponents
 
     
     /**
      * ACTIONLISTENERS
      * STARTS
      * HERE
      */
     private void jButton1ActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_jButton1ActionPerformed
         new ChooseCustomerGUI(controller, this);
     }//GEN-LAST:event_jButton1ActionPerformed
 
     private void buttonAddReceiptActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_buttonAddReceiptActionPerformed
         String firstName = fieldFirstName.getText();
         String lastName = fieldLastName.getText();
         String phoneNbr = fieldPhoneNbr.getText().replaceAll("-", "");
         String email = fieldEmail.getText();
         String receiptNbr = fieldReceiptNbr.getText();
         String lastPayDate = fieldDate.getText();
         boolean isPaid = checkIsPaid.isSelected();
         boolean articlesIsEmpty = model.getRowCount() == 0;
         
         boolean allOK = true;
         
         //CHECK FRNAMN
         if(firstName.length() == 0){
         	allOK = false;
         	if(balloonFirstName == null) balloonFirstName = new BalloonTip(fieldFirstName, new JLabel(erB + "Frnamn"+ miss + erE), style, Orientation.LEFT_ABOVE, AttachLocation.ALIGNED, 20, 10, true);
         } else {
         	if(balloonFirstName != null) {
         		balloonFirstName.setVisible(false);
         		balloonFirstName = null;
         	}
         }
         
         //CHECK EFTERNAMN
         if(lastName.length() == 0){
         	allOK = false;
         	if(balloonLastName == null) balloonLastName = new BalloonTip(fieldLastName, new JLabel(erB + "Efternamn"+ miss + erE), style, Orientation.LEFT_ABOVE, AttachLocation.ALIGNED, 20, 10, true);
         } else {
         	if(balloonLastName != null) {
         		balloonLastName.setVisible(false);
         		balloonLastName = null;
         	}
         }
         
         //CHECK TELEFONNUMMER
         if(phoneNbr.length() == 0){
         	allOK = false;
         	if(balloonPhone == null) balloonPhone = new BalloonTip(fieldPhoneNbr, new JLabel(erB + "Telefonnummer"+ miss + erE), style, Orientation.LEFT_ABOVE, AttachLocation.ALIGNED, 20, 10, true);
         	else {
         		balloonPhone.setVisible(false);
         		balloonPhone = new BalloonTip(fieldPhoneNbr, new JLabel(erB + "Telefonnummer"+ miss + erE), style, Orientation.LEFT_ABOVE, AttachLocation.ALIGNED, 20, 10, true);
         	}
         } else if(!isNumeric(phoneNbr)) {
         	allOK = false;
         	if(balloonPhone == null) balloonPhone = new BalloonTip(fieldPhoneNbr, new JLabel(erB + "Telefonnummer"+ err + "siffror och '-'." + erE), style, Orientation.LEFT_ABOVE, AttachLocation.ALIGNED, 20, 10, true);
         	else {
         		balloonPhone.setVisible(false);
         		balloonPhone = new BalloonTip(fieldPhoneNbr, new JLabel(erB + "Telefonnummer"+ err + "siffror och '-'." + erE), style, Orientation.LEFT_ABOVE, AttachLocation.ALIGNED, 20, 10, true);
         	}
         } else{
         	if(balloonPhone != null) {
         		balloonPhone.setVisible(false);
         		balloonPhone = null;
         	}
         }
         
         //CHECK EMAIL 
         if(email.length() == 0){
         	allOK = false;
         	if(balloonEmail == null) balloonEmail = new BalloonTip(fieldEmail, new JLabel(erB + "Email"+ miss + erE), style, Orientation.LEFT_ABOVE, AttachLocation.ALIGNED, 20, 10, true);
         } else {
         	if(balloonEmail != null) {
         		balloonEmail.setVisible(false);
         		balloonEmail = null;
         	}
         }
         
         
       //CHECK KVITTONUMMER
         if(receiptNbr.length() == 0){
         	allOK = false;
         	if(balloonReceiptNbr == null) balloonReceiptNbr = new BalloonTip(fieldReceiptNbr, new JLabel(erB + "Kvittonummer"+ miss + erE), style, Orientation.LEFT_ABOVE, AttachLocation.ALIGNED, 20, 10, true);
         	else {
         		balloonReceiptNbr.setVisible(false);
         		balloonReceiptNbr = new BalloonTip(fieldReceiptNbr, new JLabel(erB + "Kvittonummer"+ miss + erE), style, Orientation.LEFT_ABOVE, AttachLocation.ALIGNED, 20, 10, true);
         	}
         } else if(!isNumeric(receiptNbr)) {
         	allOK = false;
         	if(balloonReceiptNbr == null) balloonReceiptNbr = new BalloonTip(fieldReceiptNbr, new JLabel(erB + "Kvittonummer"+ err + "siffror." + erE), style, Orientation.LEFT_ABOVE, AttachLocation.ALIGNED, 20, 10, true);
         	else {
         		balloonReceiptNbr.setVisible(false);
         		balloonReceiptNbr = new BalloonTip(fieldReceiptNbr, new JLabel(erB + "Kvittonummer"+ err + "siffror." + erE), style, Orientation.LEFT_ABOVE, AttachLocation.ALIGNED, 20, 10, true);
         	}
         } else{
         	if(balloonReceiptNbr != null) {
         		balloonReceiptNbr.setVisible(false);
         		balloonReceiptNbr = null;
         	}
         }
         
         //CHECK DATE
         if(lastPayDate.length() == 0){
         	allOK = false;
         	if(balloonLastPayDate == null) balloonLastPayDate = new BalloonTip(fieldDate, new JLabel(erB + "Sista betalningsdatum"+ miss + erE), style, Orientation.LEFT_ABOVE, AttachLocation.ALIGNED, 20, 10, true);
         	else {
         		balloonLastPayDate.setVisible(false);
         		balloonLastPayDate = new BalloonTip(fieldDate, new JLabel(erB + "Sista betalningsdatum"+ miss + erE), style, Orientation.LEFT_ABOVE, AttachLocation.ALIGNED, 20, 10, true);
         	}
         } else if(!isValidDate(lastPayDate)) {
         	allOK = false;
         	if(balloonLastPayDate == null) balloonLastPayDate = new BalloonTip(fieldDate, new JLabel(erB + "Ogiltigt datum! Datumet ska va p formatet YYYY-MM-DD." + erE), style, Orientation.LEFT_ABOVE, AttachLocation.ALIGNED, 20, 10, true);
         	else {
         		balloonLastPayDate.setVisible(false);
         		balloonLastPayDate = new BalloonTip(fieldDate, new JLabel(erB + "Ogiltigt datum! Datumet ska vara p formatet YYYY-MM-DD." + erE), style, Orientation.LEFT_ABOVE, AttachLocation.ALIGNED, 20, 10, true);
         	}
         } else{
         	if(balloonLastPayDate != null) {
         		balloonLastPayDate.setVisible(false);
         		balloonLastPayDate = null;
         	}
         }
         
         //CHECK ARTICLES
         if(articlesIsEmpty) {
         	allOK = false;
         	if(balloonArticles == null) balloonArticles = new BalloonTip(tableArticles.getTableHeader(), new JLabel(erB + "Kvittot mste innehlla minst en artikel." + erE), style, Orientation.LEFT_ABOVE, AttachLocation.ALIGNED, 20, 10, true);
         } else {
         	if(balloonArticles != null) {
         		balloonArticles.setVisible(false);
         		balloonArticles = null;
         	}
         }
         
         
         
     }//GEN-LAST:event_buttonAddReceiptActionPerformed
 
     private void buttonCancelActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_buttonCancelActionPerformed
         dispose();
     }//GEN-LAST:event_buttonCancelActionPerformed
 
     private void jButton2ActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_jButton2ActionPerformed
         clearCustomerInfo();
         fieldsEnabled(true);
     }//GEN-LAST:event_jButton2ActionPerformed
 
     private void buttonAddArticleActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_buttonAddArticleActionPerformed
         new ChooseArticleGUI(controller, this);
     }//GEN-LAST:event_buttonAddArticleActionPerformed
 
     private void buttonRemoveArticleActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_buttonRemoveArticleActionPerformed
         int i = tableArticles.getSelectedRow();
         
         if(i != -1){
             articles.remove(i);
             model.removeRow(i);
         }
     }//GEN-LAST:event_buttonRemoveArticleActionPerformed
 
     private void fieldReceiptNbrActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_fieldReceiptNbrActionPerformed
         // TODO add your handling code here:
     }//GEN-LAST:event_fieldReceiptNbrActionPerformed
 
     
     /**
      * MY METHODS
      * START
      * HERE
      */
     
     /**
      * Sets customerInfo, used by ChooseCustomerGUI
      */
     public void setCustomerInfo(Customer c){
         fieldFirstName.setText(c.getFirstName());
         fieldLastName.setText(c.getLastName());
         fieldPhoneNbr.setText(c.getPhone());
         fieldEmail.setText(c.getEmail());
         fieldsEnabled(false);
     }
     
     
     public void addArticle(ReceiptArticle article){
     	String articleName = article.getArticleName();
     	int index = -1;
     	for(int i = 0; i < tableArticles.getRowCount(); i++){
     		if(model.getValueAt(i, 0).toString().equals(articleName)) index = i;
     	}
     	
     	if(index != -1) {
     		ReceiptArticle oldArticle = articles.get(index);
     		int newAmount = oldArticle.getAmount() + article.getAmount();
     		double newPrice = newAmount * oldArticle.getPrice();
     		model.setValueAt(newAmount, index, 1);
     		model.setValueAt(formatPrice("" + newPrice), index, 2);
     		oldArticle.setAmount(newAmount);
     	}else{
     		Object[] row = {article.getArticleName(), article.getAmount(), formatPrice("" + article.getPrice()*article.getAmount())};
     		model.addRow(row);
     		articles.add(article);
     	}
     	//Hr rkna om totalt pris och antal
     }
     
     /**
      * Clears all customerInfo
      */
     private void clearCustomerInfo(){
     	fieldFirstName.setText("");
         fieldLastName.setText("");
         fieldPhoneNbr.setText("");
         fieldEmail.setText("");
     }
     
     
     /**
      * Enables/disables the customer fields.
      */
     private void fieldsEnabled(boolean state){
     	if(state){
     		fieldFirstName.setEnabled(true);
             fieldLastName.setEnabled(true);
             fieldPhoneNbr.setEnabled(true);
             fieldEmail.setEnabled(true);
     	}else{
     		fieldFirstName.setEnabled(false);
             fieldLastName.setEnabled(false);
             fieldPhoneNbr.setEnabled(false);
             fieldEmail.setEnabled(false);
     	}
     }
     
     private boolean isNumeric(String s){
     	boolean result = true;
     	try {
 			Integer.parseInt(s);
 		} catch (NumberFormatException e) {
 			result = false;
 		}
     	return result;
     }
     
     private boolean isValidDate(String date){
     	date = date.trim();
 
     	if(date.length() != dateFormat.toPattern().length()) return false;
     	
     	dateFormat.setLenient(false);
     	
     	try {
 			dateFormat.parse(date);
 		} catch (ParseException e) {
 			return false;
 		}
     	return true;
     }
     
     private String formatPrice(String price) {
 		String fixedNumber = price.replace('.', ',');
 		if ((price.length() - 1) - price.indexOf(".") == 1) fixedNumber += "0";
 		return fixedNumber + "kr";
 	}
     
     // Variables declaration - do not modify//GEN-BEGIN:variables
     private javax.swing.JButton buttonAddArticle;
     private javax.swing.JButton buttonAddReceipt;
     private javax.swing.JButton buttonCancel;
     private javax.swing.JButton buttonRemoveArticle;
     private javax.swing.JCheckBox checkIsPaid;
     private javax.swing.JTextField fieldDate;
     private javax.swing.JTextField fieldEmail;
     private javax.swing.JTextField fieldFirstName;
     private javax.swing.JTextField fieldLastName;
     private javax.swing.JTextField fieldPhoneNbr;
     private javax.swing.JTextField fieldReceiptNbr;
     private javax.swing.JButton jButton1;
     private javax.swing.JButton jButton2;
     private javax.swing.JPanel jPanel3;
     private javax.swing.JScrollPane jScrollPane2;
     private javax.swing.JLabel labelAddArticles;
     private javax.swing.JLabel labelEmail;
     private javax.swing.JLabel labelFirstName;
     private javax.swing.JLabel labelLastName;
     private javax.swing.JLabel labelLastPayDay;
     private javax.swing.JLabel labelPhoneNbr;
     private javax.swing.JLabel labelReceiptNbr;
     private javax.swing.JPanel panelCustomer;
     private javax.swing.JPanel panelReceipt;
     private javax.swing.JTable tableArticles;
     // End of variables declaration//GEN-END:variables
 }
