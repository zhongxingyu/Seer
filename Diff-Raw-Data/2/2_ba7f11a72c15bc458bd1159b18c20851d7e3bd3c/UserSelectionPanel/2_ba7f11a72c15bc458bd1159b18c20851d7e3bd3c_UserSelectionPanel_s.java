 /*
  * To change this template, choose Tools | Templates
  * and open the template in the editor.
  */
 package superkidsapplication.panels;
 
 import com.ece.superkids.users.UserDatabaseFactory;
 import com.ece.superkids.users.UserManager;
 import com.ece.superkids.users.entities.User;
 import java.util.Iterator;
 import java.util.List;
 import superkidsapplication.controllers.PanelController;
 import superkidsapplication.events.Session;
 
 /**
  *
  * @author baris
  */
 public final class UserSelectionPanel extends javax.swing.JPanel {
 
     /**
      * Creates new form UserSelectionPanel
      */
     private StartScreenPanel startscreen;
     //get the panel controller to manage panels
     private PanelController controller;
     private UserManager uM = UserDatabaseFactory.aUserManager();
     private Session session = Session.aSession();
 
     public UserSelectionPanel() {
         this.setName("UserSelection");
         initComponents();
         //get the startscreen
         startscreen = StartScreenPanel.getInstance();
         //get controller
         controller = PanelController.getInstance();
         fillBox();
     }
 
     /**
      * This method is called from within the constructor to initialize the form.
      * WARNING: Do NOT modify this code. The content of this method is always
      * regenerated by the Form Editor.
      */
     @SuppressWarnings("unchecked")
     // <editor-fold defaultstate="collapsed" desc="Generated Code">//GEN-BEGIN:initComponents
     private void initComponents() {
 
         jLayeredPane1 = new javax.swing.JLayeredPane();
         jLabel1 = new javax.swing.JLabel();
         usersBox = new javax.swing.JComboBox();
         loginButton = new javax.swing.JButton();
         warnLabel = new javax.swing.JLabel();
         helloLabel = new javax.swing.JLabel();
         jLabel2 = new javax.swing.JLabel();
         background = new javax.swing.JLabel();
 
         setPreferredSize(new java.awt.Dimension(800, 600));
 
         jLayeredPane1.setPreferredSize(new java.awt.Dimension(800, 600));
 
         jLabel1.setFont(new java.awt.Font("Arial Rounded MT Bold", 0, 36)); // NOI18N
         jLabel1.setForeground(new java.awt.Color(255, 255, 255));
         jLabel1.setText("Select the User");
         jLabel1.setBounds(60, 140, 290, 80);
         jLayeredPane1.add(jLabel1, javax.swing.JLayeredPane.DEFAULT_LAYER);
 
         usersBox.addActionListener(new java.awt.event.ActionListener() {
             public void actionPerformed(java.awt.event.ActionEvent evt) {
                 usersBoxActionPerformed(evt);
             }
         });
         usersBox.setBounds(80, 230, 230, 27);
         jLayeredPane1.add(usersBox, javax.swing.JLayeredPane.DEFAULT_LAYER);
 
         loginButton.setText("Login");
         loginButton.addActionListener(new java.awt.event.ActionListener() {
             public void actionPerformed(java.awt.event.ActionEvent evt) {
                 loginButtonActionPerformed(evt);
             }
         });
         loginButton.setBounds(150, 399, 79, 60);
         jLayeredPane1.add(loginButton, javax.swing.JLayeredPane.DEFAULT_LAYER);
 
         warnLabel.setFont(new java.awt.Font("Arial Rounded MT Bold", 0, 18)); // NOI18N
         warnLabel.setForeground(new java.awt.Color(255, 0, 0));
        warnLabel.setBounds(0, 0, 0, 0);
         jLayeredPane1.add(warnLabel, javax.swing.JLayeredPane.DEFAULT_LAYER);
 
         helloLabel.setFont(new java.awt.Font("Arial Rounded MT Bold", 0, 18)); // NOI18N
         helloLabel.setForeground(new java.awt.Color(255, 255, 255));
         helloLabel.setBounds(420, 460, 360, 50);
         jLayeredPane1.add(helloLabel, javax.swing.JLayeredPane.DEFAULT_LAYER);
 
         jLabel2.setIcon(new javax.swing.ImageIcon(getClass().getResource("/characters/Boy.png"))); // NOI18N
         jLabel2.setBounds(490, 230, 140, 220);
         jLayeredPane1.add(jLabel2, javax.swing.JLayeredPane.DEFAULT_LAYER);
 
         background.setIcon(new javax.swing.ImageIcon(getClass().getResource("/backgrounds/BasicScreen.png"))); // NOI18N
         background.setText("jLabel2");
         background.setMaximumSize(new java.awt.Dimension(800, 600));
         background.setMinimumSize(new java.awt.Dimension(800, 600));
         background.setPreferredSize(new java.awt.Dimension(800, 600));
         background.setBounds(0, -10, 800, 620);
         jLayeredPane1.add(background, javax.swing.JLayeredPane.DEFAULT_LAYER);
 
         org.jdesktop.layout.GroupLayout layout = new org.jdesktop.layout.GroupLayout(this);
         this.setLayout(layout);
         layout.setHorizontalGroup(
             layout.createParallelGroup(org.jdesktop.layout.GroupLayout.LEADING)
             .add(jLayeredPane1, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE, 800, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE)
         );
         layout.setVerticalGroup(
             layout.createParallelGroup(org.jdesktop.layout.GroupLayout.LEADING)
             .add(org.jdesktop.layout.GroupLayout.TRAILING, layout.createSequentialGroup()
                 .add(0, 0, Short.MAX_VALUE)
                 .add(jLayeredPane1, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE, 612, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE))
         );
     }// </editor-fold>//GEN-END:initComponents
 
     private void usersBoxActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_usersBoxActionPerformed
         // TODO add your handling code here:
         helloLabel.setText("Hello! My name is "+usersBox.getSelectedItem()+".");
     }//GEN-LAST:event_usersBoxActionPerformed
 
     private void loginButtonActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_loginButtonActionPerformed
         // TODO add your handling code here:
         if (usersBox.getItemCount() == 0) {
             warnLabel.setText("Please add a child first.");
             return;
         }
         //get user
         User user = uM.getUser((String) usersBox.getSelectedItem());
         //login
         if (session.login(user) == false) {
             warnLabel.setText("Already logged in");
             return;
         }
         //change the button visibility in the main frame
         MainFrame frame = (MainFrame) javax.swing.SwingUtilities.getWindowAncestor(this);
         frame.logoutButton.setVisible(true);
         controller.addPanel(startscreen);
     }//GEN-LAST:event_loginButtonActionPerformed
     // Variables declaration - do not modify//GEN-BEGIN:variables
     private javax.swing.JLabel background;
     private javax.swing.JLabel helloLabel;
     private javax.swing.JLabel jLabel1;
     private javax.swing.JLabel jLabel2;
     private javax.swing.JLayeredPane jLayeredPane1;
     private javax.swing.JButton loginButton;
     private javax.swing.JComboBox usersBox;
     private javax.swing.JLabel warnLabel;
     // End of variables declaration//GEN-END:variables
 
     public void fillBox() {
         usersBox.removeAllItems();
         warnLabel.setText("");
         List usersList = uM.getAllUsers();
         Iterator<User> iterator = usersList.iterator();
         while (iterator.hasNext()) {
             usersBox.addItem(iterator.next().getName());
         }
     }
 }
