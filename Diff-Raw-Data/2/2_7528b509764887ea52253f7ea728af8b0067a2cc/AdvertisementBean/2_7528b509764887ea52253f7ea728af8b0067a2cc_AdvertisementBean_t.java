 /* - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
  Copyright (C) 2008 CEJUG - Ceará Java Users Group
  
  This library is free software; you can redistribute it and/or
  modify it under the terms of the GNU Lesser General Public
  License as published by the Free Software Foundation; either
  version 2.1 of the License, or (at your option) any later version.
  
  This library is distributed in the hope that it will be useful,
  but WITHOUT ANY WARRANTY; without even the implied warranty of
  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
  Lesser General Public License for more details.
  
  You should have received a copy of the GNU Lesser General Public
  License along with this library; if not, write to the Free Software
  Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA 02111-1307 USA
  
  This file is part of the CEJUG-CLASSIFIEDS Project - an  open source classifieds system
  originally used by CEJUG - Ceará Java Users Group.
  The project is hosted https://cejug-classifieds.dev.java.net/
  
  You can contact us through the mail dev@cejug-classifieds.dev.java.net
  - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - */
 package net.java.dev.cejug.classifieds.view.jsf;
 
 import java.util.Calendar;
 import java.util.GregorianCalendar;
 
 import javax.faces.application.FacesMessage;
 import javax.faces.context.FacesContext;
 import javax.faces.event.ActionEvent;
 import javax.xml.datatype.DatatypeConfigurationException;
 import javax.xml.datatype.DatatypeFactory;
 
 import net.java.dev.cejug.classifieds.model.service.AdvertisementService;
 import net.java.dev.cejug_classifieds.business.CejugClassifiedsBusiness;
 import net.java.dev.cejug_classifieds.business.CejugClassifiedsServiceBusiness;
 import net.java.dev.cejug_classifieds.metadata.business.Advertisement;
 import net.java.dev.cejug_classifieds.metadata.business.Locale;
 import net.java.dev.cejug_classifieds.metadata.business.Period;
 import net.java.dev.cejug_classifieds.metadata.business.PublishingHeader;
 import net.java.dev.cejug_classifieds.metadata.common.Customer;
 
 /**
  * This class is responsible for the operations related to advertisement.
  * 
  * @author $Author$
  * @version $Rev$ ($Date$)
  */
 public class AdvertisementBean {
 	/**
 	 * The actual advertisement this bean is editing or publishing.
 	 */
 	private Advertisement advertisement = new Advertisement();
 	/**
 	 * The advertisement service to communicate with the server
 	 */
 	private AdvertisementService adsService;
 
	/**short
 	 * Publish the advertisement.
 	 * 
 	 * @param actionEvent
 	 *            the event generated by component
 	 */
 	public void publish(ActionEvent actionEvent) {
 		try {
 			/**
 			 * TODO: the domain should be provided by the client to the server,
 			 * and it should be previously registered in the cejug-classifieds
 			 * server. Only known domain can publish advertisements.
 			 */
 			Advertisement advertisement = getAdvertisement();
 
 			Customer customer = new Customer();
 			customer.setLogin("fgaucho");
 			customer.setDomainId(1);
 			advertisement.setCustomer(customer);
 			advertisement.setTypeId(1);
 
 			// Publishing period
 			DatatypeFactory factory = DatatypeFactory.newInstance();
 			Calendar today = GregorianCalendar.getInstance();
 			Period period = new Period();
 			period.setStart(factory
 					.newXMLGregorianCalendar((GregorianCalendar) today));
 
 			Calendar fiveDaysLater = GregorianCalendar.getInstance();
 			fiveDaysLater.roll(Calendar.DAY_OF_YEAR, 5);
 			period
 					.setFinish(factory
 							.newXMLGregorianCalendar((GregorianCalendar) fiveDaysLater));
 
 			// Advertisement contents
 			advertisement.setPublishingPeriod(period);
 			advertisement.setCategoryId(1);
 			Locale locale = new net.java.dev.cejug_classifieds.metadata.business.Locale();
 			locale.setLanguage("pt");
 			locale.setCountry("BR");
 			advertisement.setLocale(locale);
 			advertisement.setStatus(1);
 
 			PublishingHeader header = new PublishingHeader();
 			header.setCustomerDomainId(1);
 			header.setCustomerLogin("fgaucho");
 
 			CejugClassifiedsBusiness service = new CejugClassifiedsServiceBusiness()
 					.getCejugClassifiedsBusiness();
 
 			Advertisement adv = service.publishOperation(advertisement, header);
 			// TODO: implement the front-end behavior after the server response.
 			FacesContext.getCurrentInstance().addMessage(
 					null,
 					new FacesMessage(adv.getEntityId()
 							+ " <<< the ID of the created advertisement :)"));
 			// "Your advertisement was published. Can you see it?"));
 		} catch (DatatypeConfigurationException e) {
 			// TODO Logging, throws customer error message.....
 			e.printStackTrace();
 		} catch (Exception runntimeError) {
 			// TODO Logging, throws customer error message.....
 			runntimeError.printStackTrace();
 		}
 	}
 
 	public Advertisement getAdvertisement() {
 		return advertisement;
 	}
 
 	public void setAdvertisement(Advertisement advertisement) {
 		this.advertisement = advertisement;
 	}
 
 	public AdvertisementService getAdsService() {
 		return adsService;
 	}
 
 	public void setAdsService(AdvertisementService adsService) {
 		this.adsService = adsService;
 	}
 }
