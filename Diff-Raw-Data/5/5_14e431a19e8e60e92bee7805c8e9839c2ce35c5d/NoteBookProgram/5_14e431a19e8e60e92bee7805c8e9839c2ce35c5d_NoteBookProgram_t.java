 // Copyright (c) 2011 Martin Ueding <dev@martin-ueding.de>
 
 package jscribble;
 
 import java.io.BufferedOutputStream;
 import java.io.File;
 import java.io.FileNotFoundException;
 import java.io.FileOutputStream;
 import java.io.IOException;
 
 import javax.swing.JOptionPane;
 
 /**
  * The main program.
  *
  * @author Martin Ueding <dev@martin-ueding.de>
  */
 public class NoteBookProgram {
 	/**
 	 * Stream for the logfile.
 	 */
 	private static BufferedOutputStream outstream;
 
 
 	/**
 	 * The folder where everything is stored.
 	 */
 	private static File dotDir = new File(System.getProperty("user.home") + File.separator + ".jscribble");
 
 
 	/**
 	 * Generates a "generated by <program name> <version>" string.
 	 *
 	 * @return version string
 	 */
 	public static String generatedComment() {
 		return "generated by jscribble " + VersionName.version;
 	}
 
 
 	/**
 	 * Getter for dotDir.
 	 */
 	public static File getDotDir() {
 		return dotDir;
 	}
 
 
 	/**
 	 * Returns the name of the program.
 	 */
 	private static String getProgramname() {
 		return "jscribble";
 	}
 
 
 	/**
 	 * Handles some error message centrally, right now it just displays a dialog box with the error message.
 	 *
 	 * @param errorMessage error message
 	 */
 	public static void handleError(String errorMessage) {
 		JOptionPane.showMessageDialog(null, errorMessage);
 	}
 
 
 	/**
 	 * Creates the logfile and initializes the stream.
 	 */
 	private static void initLogfileOutstream() {
 		try {
			outstream = new BufferedOutputStream(new FileOutputStream(new File(System.getProperty("java.io.tmpdir") + File.separator + "jscribble.log")));
 		}
 		catch (FileNotFoundException e) {
			handleError("Cannot create logfile.");
 			e.printStackTrace();
 		}
 	}
 
 
 	/**
 	 * Writes a message to a log file.
 	 *
 	 * @param reportingClass name of the reporting class
 	 * @param message message
 	 */
 	public static void log(String reportingClass, String message) {
 		String output = reportingClass + ":\t" + message;
 		System.out.println(output);
 
 		if (outstream != null) {
 			try {
 				outstream.write((output + "\n").getBytes());
 			}
 			catch (IOException e) {
 				System.out.println(output);
 				e.printStackTrace();
 			}
 		}
 	}
 
 
 	/**
 	 * Displays the NotebookSelectionWindow.
 	 *
 	 * @param args CLI arguments
 	 */
 	public static void main(String[] args) {
 		printVersionIfNeeded(args);
 
 		initLogfileOutstream();
 
 		log(getProgramname(), "Starting up.");
 
 		showSelectionWindow();
 
 		log(NoteBookProgram.class.getClass().getName(), "Entering interactive mode.");
 	}
 
 
 	/**
 	 * Prints version number and exists if there is a "--version" argument.
 	 *
 	 * @param args CLI arguments
 	 */
 	private static void printVersionIfNeeded(String[] args) {
 		if (args.length > 0 && args[0].equals("--version")) {
 			System.out.println("Version: " + VersionName.version);
 			System.exit(0);
 		}
 	}
 
 
 	/**
 	 * Shows the NotebookSelectionWindow.
 	 */
 	private static void showSelectionWindow() {
 		NotebookSelectionWindow nsw = new NotebookSelectionWindow();
 		nsw.showDialog();
 	}
 }
